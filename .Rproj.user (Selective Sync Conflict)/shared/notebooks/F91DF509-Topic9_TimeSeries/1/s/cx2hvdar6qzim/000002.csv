"0","library(dplyr)"
"0","library(lubridate)"
"0","nyt <- read.csv(url(""https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv""))"
"0","nyt=nyt%>%mutate(date=as.character(date))"
"0","maxt=max(nyt$date)"
"0","nytmax=nyt%>% filter(date==maxt)"
"0","covidus=nyt %>% group_by(date) %>% summarise_at(vars(cases,deaths),sum)"
"0",""
"0","start.date = ymd_hms(""2008-01-05 00:00:00"")"
"0","end.date   = as_datetime(now()) #ymd_hms(""2020-04-02 01:00:00"")"
"0","#end.date   = ymd_hms(""2020-04-04 01:00:00"")"
"0","breaks = seq(start.date, end.date, ""1 week"")"
"0",""
"0","covidus = covidus %>% mutate(date=as_datetime(date),"
"0","                             week=cut(date, breaks=breaks)) %>% "
"0","          group_by(week) %>%  "
"0","          summarise_at(vars(cases,deaths),max)"
"0",""
"0",""
"0","wei=read.csv(""https://www.dropbox.com/s/d4h50imfkvmo2la/weekly-economic-index_data.csv?dl=1"") %>% "
"0","    rename(week=Date)"
"0","    #mutate(week=as.character(as_date(Date)))  "
"0","    #mutate(week=gsub(""/"",""-"",Date))"
"0",""
"0",""
"0",""
"0","ld=read.csv(""https://www.dropbox.com/s/q599zbhc1wfxoju/lockdown_us.csv?dl=1"")"
"0","ld=ld %>% group_by(State) %>% filter(Date==min(Date)) %>% distinct(State,Date) %>% rename(state=State)"
"0",""
"0","pp=read.csv(""https://www.dropbox.com/s/whsm336mwqzch57/statistic_id183497_population-in-the-states-of-the-us-2019.csv?dl=1"")"
"0",""
"0","uspop=sum(pp$popmm)"
"0",""
"0","ldpp=pp %>% left_join(ld,by=""state"") %>% group_by(Date) %>% "
"0","     summarise_at(vars(popmm),sum) %>% filter(is.na(Date)==F) %>% "
"0","     mutate(cumpopmm=cumsum(popmm))"
"0",""
"0","ldppweek=wei %>% mutate( Fweek=dplyr::lead(week) ) %>% merge(ldpp) %>% filter(Date>week & Date<Fweek) %>% "
"0","         group_by(week) %>% "
"0","         summarise(lockshare=max(cumpopmm/uspop)) %>% mutate(week=as_date(week))"
"0",""
"0",""
"0","df=wei %>%  left_join(covidus, by=""week"") %>%  "
"0","   mutate(week=as_date(week),cases=replace(deaths,is.na(cases),0),"
"0","                  deaths=replace(deaths,is.na(deaths),0),lnindex=log(Index)) %>% "
"0","   left_join(ldppweek,by=""week"") %>% mutate(lockshare=replace(lockshare,is.na(lockshare),0),lockshare=cummax(lockshare)*100) %>% "
"0","   mutate(cases=cases/100000,deaths=deaths/100000)"
"0","   "
"0",""
"0",""
