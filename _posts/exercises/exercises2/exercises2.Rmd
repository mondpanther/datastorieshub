---
title: "Exercises 2"
description: |
  Exercises to get familiar with R.
author:
  - name: Ralf Martin
    url: https://mondpanther.github.io/wwwmondpanther/
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: true
    css: ../../webex.css
    includes:
      after_body: ../../webex.js
categories:
  - Exercises
editor_options: 
  chunk_output_type: inline
---



```{r setup, include = FALSE, message=FALSE}
library("webex")
library(ggplot2)
knitr::opts_chunk$set(fig.path='../../../images/')



part=function(reset=FALSE){
  if(reset){ pp <<- 0}
  pp <<- pp+1
  rr=letters[pp]
  
  return(rr)
}

part(TRUE)
part()

```



# Exercise 2.1

In the lecture we introduced R. The goal of this problem set is for you to work with R by yourself, so that you start to become comfortable with some basic commands, which will be needed throughout the course (and beyond?). Hence, even if you think you could answer a question with a different software package, could you please try using R?

In this exercise we are using a dataset called `auto.csv`. It contains various characteristics for a sample of cars.
You can download this dataset from [here](https://www.dropbox.com/s/gm22o5efboc3q0w/auto.csv?dl=1) from the course data repository. Note that a big part of working with data is to become familiar with different data formats. R can easily work with almost any dataformat imaginable but only if the user (i.e. you) gives it the right instructions. You are probably already familiar with the `.csv` format. But just in case not: `csv` stands for comma separated values. In other words: this is a table with arranged as a simple text file where rows represent table rows and the values that go into separate columns are separated by commas. 

To do anything with data you need get a dataset into a dataframe (essentially another word for table) in memory. For that you can first store it on your computer's harddrive and then  load it. You can do that using RStudio's import file menu very similar to how you would open an Excel worksheet, say:

```{r out.extra='style="max-width: 500px"', echo=F}
knitr::include_graphics("../../../images/fileimport.png")
```


### Part (`r part(TRUE)`) 
Instead of using the import dialog, can you load the dataset with an R command either from the console command line or via an R script?


`r hide("Hint:")`

If you use the RStudio dialog just discussed it will show you the R command that is needed in the Console window

`r unhide()`

`r hide("Answer:")`
```{r load auto, echo = TRUE}
auto <- read.csv("C:/Users/Ralf Martin/Dropbox/datastories/data/auto.csv", header=TRUE)


```

Of course the exact formulation depends on where you saved your file on disk; i.e. it is unlikely it will be in a directory called `C:/Users/Ralf Martin/Dropbox/datastories/data/`.

Note that `header=TRUE` means that R can figure out the column names from the first line of the `auto.csv` file.
`r unhide()`



### Part (`r part()`)
Can you suggest an alternative version of the previous command with a relative path to locate the file?
`r hide("Answer:")`
```{r, echo = TRUE}
getwd()
```

To write a relative path you need to know which the current active directory is. With the `getwd()` command you can find out. In my case this happens to be the  `C:/Users/Ralf Martin/Dropbox/datastories/datastorieshub/_posts/exercises/exercises2` directory. Hence to get to directory `C:/Users/Ralf Martin/Dropbox/datastories/data` we need to go 4 directories up (to directory `C:/Users/Ralf Martin/Dropbox/datastories` ) and then down into the data directory. Note that you can use `..` to indicate to R that you want to move up one layer of the directory structure. Hence the corect command with relative path notation becomes:

```{r, echo = TRUE}
auto <- read.csv("../../../../data/auto.csv", header=TRUE)

```



`r unhide()`


### Part (`r part()`)
Probably the easiest way to load a web based CSV file into R is directly from the web. This can be achieved by using the file URL in the `read.csv` command. Can you work out how?


`r hide("Answer:")`
```{r, echo = TRUE}
auto <- read.csv("https://www.dropbox.com/s/gm22o5efboc3q0w/auto.csv?dl=1", header=TRUE)

```

You can figure out the URL by right clicking on a hyperlink.
`r unhide()`


### Part (`r part()`)
Describe the data set. 

How many observations does the data set have? `r fitb(nrow(auto))`

and how many variables does it have? `r fitb(ncol(auto))`

What variables are contained in the dataset?

`r hide("Hint:")`
R commands you might want to use for that include summary, nrow, ncol. You can try to type ?<name of function> in the RStudio console to learn more about the function. Alternatively, try googling and see how people use those functions.
`r unhide()`

`r hide("Answer:")`
```{r, echo = TRUE}
# Summary stats for all variables
summary(auto)

# Number of observations:
nrow(auto)

#Number of variables
ncol(auto)


#Just the names of all variables
names(auto)
```
`r unhide()`

### Part (e)
Much of the power of R derives from extensions (so called packages) that have been contributed to widen the capabilities of the basic software. A particularly nice extension are the dplyr and tidyr packages that allow vastly more efficient and transparent wrangling of data. Can you install those packages on your computer and load them into memory?


`r hide("Answer:")`
To install these packages use 
`install.packages("dplyr","tydr")`

Note that you only need to do this once on a given computer (it's like installing software).
However, each time you re-start R you need to load the packages you want to use into memory again. For that you use

```{r,echo=TRUE}
library(dplyr)
library(tidyr)
```
`r unhide()`

### Part (`r part()`)
One of the great things included in those packages is the functionality of piping, which we shall be using extensively throughout this course. Piping allows you to send
the result from one R command to the next. This typically allows for more transparent code as you will hopefully appreciate maybe not just yet but sometime halfway through the course.

Just to give you an idea what piping does look at the code below. It does exactly the same as the `summary(auto)` command but we have now
written with the piping operator `%>%`. What it does is that it sends whatever comes on the left to the right (i.e. flushes it down the `%>%` pipe ). On the right hand side it is then being used as an argument to the code that comes there (hence we don't need to put anything in brackets in the summary command)

```{r,echo=TRUE}
auto %>% summary()
```

You can even do several of those pipes in a row. For instance, look at the following piece of code. Can you work out what it does?



```{r, echo=TRUE}
auto_summary <- auto %>%   select(mpg, weight)  %>% 
             summarise_all( list(mmm=mean,  p50=median, sd=sd  ) ) 

```

`r hide("Answer:")`

This piece of code takes first selects only 2 columns of the `auto` dataframe.
It sends this smaller dataframe with only 2 variables to the command
`summarise_all`. Summarise all will compute the statistics you mention within
`list(...)` for all the variables in the dataframe it is being given.
Note that in the list what comes after the `=` sign is the statistic you want whereas what comes before is a lable that will appear in the resulting 
dataframe, which we called `auto_summary`. You can look at it simply by typing 
its name in the console or a script:

```{r,echo=TRUE}
auto_summary

```

`r unhide()`


### Part (`r part()`)
The summary statistics in the previous part are not displayed very nice.
The dplyr and tidyr offer alot of nice functions to reshape any output
in whichever way you want. Below is a somewhat elaborate example. Below I am explaining step by step what it does. However, before you look at my explanation, maybe you can run those commands yourself step by step and figure what they do?

```{r, echo=TRUE}

auto_summary_reshape <- auto_summary %>% gather(stat, val) %>%
                    separate(stat, into = c("var", "stat"), sep = "_") %>%
                    spread(stat,val) 


```





`r hide("Explanation:")`

The code above reshapes the `auto_summary` dataframe so that it looks like this:

```{r, echo=TRUE}
auto_summary_reshape 
```


We can break this in all the steps to see how it does that:

```{r,echo=TRUE}

 step = auto_summary %>% gather(stat, val)
 step
```
The gather command arranges what you sent them down the pipe as key value pairs; i.e. 2 columns
where the first column is the key (i.e. a name or label) for the value that follows in the value column. `stat` and `val` are simply how we want to call those two columns


```{r,echo=TRUE}

 step = step %>% separate(stat, into = c("var", "stat"), sep = "_")
 step
```

The separate command splits the `stat` column in two new columns, `var` and `stat` where `sep="_"` tells R where to separate the original `stat` column.



```{r,echo=TRUE}

 step = step %>% spread(stat, val) 
 step
```

The spread command spreads out the stat column again; i.e. creates a new column for every category represented in stat. Alternatively, we could have spread var:


```{r, echo=TRUE}
auto_summary %>% gather(stat, val) %>%
                    separate(stat, into = c("var", "stat"), sep = "_") %>%
                    spread(var,val) 

```


`r unhide()`


